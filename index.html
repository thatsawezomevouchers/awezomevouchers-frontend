<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Awezome Vacation Vouchers</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f6f8;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .card {
      width: 100%;
      max-width: 600px;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 16px;
    }
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 12px;
      margin-top: 20px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
    }
    #priceDisplay {
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Awezome Vacation Vouchers</h1>
    
    <label for="search">Search Destinations</label>
    <input type="text" id="search" placeholder="Type country or city name...">
    
    <label for="country">Country / Region</label>
    <select id="country">
      <option value="">Select Country</option>
    </select>
    
    <label for="city">City / Destination</label>
    <select id="city">
      <option value="">Select Destination</option>
    </select>
    
    <label for="promo">Promo code (optional)</label>
    <input type="text" id="promo" placeholder="Enter promo code">
    
    <label for="name">Full Name</label>
    <input type="text" id="name" placeholder="Enter your name">
    
    <label for="email">Email</label>
    <input type="email" id="email" placeholder="Enter your email">
    
    <label for="phone">Phone Number</label>
    <input type="tel" id="phone" placeholder="Enter your phone number">
    
    <div id="priceDisplay">Voucher Price: $0</div>
    
    <button id="payBtn">Pay with Card / Apple Pay</button>
    <p style="text-align: center; color: #666; font-size: 14px; margin-top: 10px;">
      If Apple Pay doesn't appear, you can still pay via card checkout.
    </p>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
  // Simple destinations list
  const destinations = {
    "Special Vouchers": [
      "7-Night Villa Voucher - 8 Days, 7 Nights",
      "3 Days, 2 Nights All-Inclusive Voucher - 3 Days, 2 Nights"
    ],
    "Cruise Destinations": [
      "Cruise Vacation - 3-14 Days Available"
    ],
    "United States": [
      "Las Vegas - 4 Days, 3 Nights",
      "Orlando - 4 Days, 3 Nights",
      "Miami - 4 Days, 3 Nights"
    ],
    "Australia": [
      "Sydney, NSW - 4 Days, 3 Nights",
      "Melbourne, VIC - 4 Days, 3 Nights",
      "Brisbane, QLD - 4 Days, 3 Nights"
    ]
  };

  const countrySelect = document.getElementById('country');
  const citySelect = document.getElementById('city');
  const searchBox = document.getElementById('search');
  const promoInput = document.getElementById('promo');
  const priceDisplay = document.getElementById('priceDisplay');
  const payBtn = document.getElementById('payBtn');

  // Populate countries
  function populateCountries() {
    countrySelect.innerHTML = '<option value="">Select Country</option>';
    Object.keys(destinations).forEach(country => {
      const option = document.createElement('option');
      option.value = country;
      option.textContent = country;
      countrySelect.appendChild(option);
    });
  }

  // Populate cities
  function populateCities(country) {
    citySelect.innerHTML = '<option value="">Select Destination</option>';
    if (country && destinations[country]) {
      destinations[country].forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });
    }
  }

  // Calculate price
  function computePrice(country) {
    if (!country) return 0;
    let base = (country === "Special Vouchers" || country === "Cruise Destinations") ? 100 : 75;
    const promo = promoInput.value.toLowerCase();
    if (promo === "thats50" && base === 75) return 50;
    if (promo === "thats75" && base === 100) return 75;
    if (promo === "thatsfamily") return Math.round(base * 0.5);
    return base;
  }

  function updatePrice() {
    priceDisplay.textContent = `Voucher Price: $${computePrice(countrySelect.value)}`;
  }

  // Event listeners
  countrySelect.addEventListener('change', function() {
    populateCities(this.value);
    updatePrice();
  });

  promoInput.addEventListener('input', updatePrice);
  citySelect.addEventListener('change', updatePrice);

  // Search functionality
  searchBox.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    if (!query) {
      populateCountries();
      return;
    }
    populateCountries();
    // Simple search - just filter the dropdown
    Array.from(countrySelect.options).forEach(option => {
      if (option.value && !option.value.toLowerCase().includes(query)) {
        option.style.display = 'none';
      } else {
        option.style.display = '';
      }
    });
  });

  // Payment handler
  payBtn.addEventListener('click', async function() {
    const country = countrySelect.value;
    const city = citySelect.value;
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const price = computePrice(country);

    if (!country || !city || !email) {
      alert('Please fill in all required fields');
      return;
    }

    this.disabled = true;
    this.textContent = 'Processing...';

    try {
      console.log('Sending payment request...');
      const response = await fetch('https://awezomevouchers-backend.vercel.app/api/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ country, city, name, email, phone, price })
      });

      const data = await response.json();
      
      if (data.url) {
        window.location.href = data.url;
      } else {
        alert('Payment error: ' + (data.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Payment failed:', error);
      alert('Network error. Please try again.');
    } finally {
      this.disabled = false;
      this.textContent = 'Pay with Card / Apple Pay';
    }
  });

  // Initialize
  populateCountries();
  updatePrice();
  </script>
</body>
</html>
