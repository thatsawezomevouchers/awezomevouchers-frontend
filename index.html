<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Awezome Vacation Vouchers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Arial; background:#f4f6f8; padding:24px; display:flex;justify-content:center}
    .card{width:100%;max-width:640px;background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(20,20,20,.08)}
    h1{margin:0 0 10px}
    label{display:block;margin-top:12px;font-weight:600}
    input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #d0d7de;font-size:15px}
    #priceDisplay{margin-top:14px;font-weight:700;text-align:center}
    button {background:#0070f3;color:white;border:0}
    button:disabled{opacity:.5}
  </style>
</head>
<body>
  <div class="card">
    <h1>Awezome Vacation Vouchers</h1>

    <label for="search">Search (country or city)</label>
    <input id="search" placeholder="Start typing country or city name..." />

    <label for="country">Country / Region</label>
    <select id="country"><option value="">Select Country / Region</option></select>

    <label for="city">City / Destination</label>
    <select id="city"><option value="">Select Destination</option></select>

    <label for="promo">Promo code (optional)</label>
    <input id="promo" placeholder="Enter promo code" />

    <div id="priceDisplay">Voucher Price: $0</div>

    <button id="payBtn">Pay with Card / Apple Pay</button>
    <p style="margin-top:10px;font-size:13px;color:#666">
      If Apple Pay doesn't appear on your device, customers can also pay via your external channels.
    </p>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
  // ---------- CONFIG: replace with your values if needed ----------
  const STRIPE_PUBLISHABLE_KEY = "pk_test_51SPYOdAfSKyDUssUW29eSSoNNNBb3A6RR4TdZ4Z3Srhg4Geejvy78Wk35to6nYHH6EwhUkxCjPMnlq14fsTI7QGS000j7dd2b8"; 
  // Set your backend endpoint (must be https). Example:
  let BACKEND_URL = "https://awezomevouchers-backend.vercel.app"; // <-- replace with your backend
  // ---------------------------------------------------------------

  const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);

  // PROMO RULES mirror backend
  function computeClientPrice(country, city, promo) {
    // default $75 for regular, $100 for Special Vouchers and Cruise Vacations
    let base = 75;
    if (country === "Special Vouchers" || country === "Cruise Destinations" || country === "Cruise Vacations") base = 100;
    // promo codes
    if (!promo) return base;
    const p = promo.trim().toLowerCase();
    if (p === "thats50" && base === 75) return 50;
    if (p === "thats75" && base === 100) return 75;
    if (p === "thatsfamily") return Math.round(base * 0.5);
    return base;
  }

  const countrySelect = document.getElementById("country");
  const citySelect = document.getElementById("city");
  const promoInput = document.getElementById("promo");
  const priceDisplay = document.getElementById("priceDisplay");
  const searchBox = document.getElementById("search");
  const payBtn = document.getElementById("payBtn");

  // ---------- Full destinations list (alphabetized by country, city arrays already sorted) ----------
  // This list is derived from the list you gave me, sorted and arranged. Add or edit entries here if needed.
  const destinations = {
    "Special Vouchers": [
      "7-Night Villa Voucher (8 Days, 7 Nights)",
      "3 Days, 2 Nights All-Inclusive Voucher (3 Days, 2 Nights)"
    ],
    "Cruise Destinations": [
      "Cruise Vacation (3-14 Days Available)"
    ],
    "Argentina": ["Buenos Aires (5 Days, 4 Nights)"],
    "Australia": [
      "Brisbane, QLD (4 Days, 3 Nights)",
      "Cairns, QLD (4 Days, 3 Nights)",
      "Darwin, NT (4 Days, 3 Nights)",
      "Gold Coast, QLD (4 Days, 3 Nights)",
      "Mackay, QLD (4 Days, 3 Nights)",
      "Melbourne, VIC (4 Days, 3 Nights)",
      "Perth, WA (4 Days, 3 Nights)",
      "Rockhampton, QLD (4 Days, 3 Nights)",
      "Sydney, NSW (4 Days, 3 Nights)",
      "Townsville, QLD (4 Days, 3 Nights)"
    ],
    "Austria": ["Vienna (5 Days, 4 Nights)"],
    "Belgium": ["Brussels (4 Days, 3 Nights)"],
    "Brazil": ["Rio de Janeiro (5 Days, 4 Nights)"],
    "Canada": [
      "Calgary (4 Days, 3 Nights)",
      "Edmonton (4 Days, 3 Nights)",
      "Halifax (4 Days, 3 Nights)",
      "Montreal (4 Days, 3 Nights)",
      "Niagara Falls (4 Days, 3 Nights)",
      "Ottawa (4 Days, 3 Nights)",
      "Quebec (4 Days, 3 Nights)",
      "Revelstoke (4 Days, 3 Nights)",
      "Toronto (4 Days, 3 Nights)",
      "Vancouver (4 Days, 3 Nights)",
      "Victoria (4 Days, 3 Nights)",
      "Winnipeg (4 Days, 3 Nights)"
    ],
    "China": ["Beijing (5 Days, 4 Nights)", "Macau (6 Days, 5 Nights)"],
    "Colombia": ["Cartagena (5 Days, 4 Nights)","MedellÃ­n (5 Days, 4 Nights)"],
    "Croatia": ["Dubrovnik (5 Days, 4 Nights)"],
    "Denmark": ["Copenhagen (5 Days, 4 Nights)"],
    "Dominican Republic": ["Punta Cana (5 Days, 4 Nights)","Puerto Plata (6 Days, 5 Nights)"],
    "Fiji": ["Fiji (5 Days, 4 Nights)"],
    "France": ["Cannes (4 Days, 3 Nights)","Paris (5 Days, 4 Nights)"],
    "Germany": ["Berlin (4 Days, 3 Nights)","Munich (5 Days, 4 Nights)"],
    "Greece": ["Athens (5 Days, 4 Nights)","Crete (6 Days, 5 Nights)","Santorini (6 Days, 5 Nights)"],
    "Hungary": ["Budapest (5 Days, 4 Nights)"],
    "Iceland": ["Reykjavik (5 Days, 4 Nights)"],
    "India": ["Goa (5 Days, 4 Nights)"],
    "Indonesia": ["Bali (5 Days, 4 Nights)"],
    "Ireland": ["Dublin (4 Days, 3 Nights)"],
    "Israel": ["Jerusalem (5 Days, 4 Nights)"],
    "Italy": ["Amalfi Coast (5 Days, 4 Nights)","Florence (5 Days, 4 Nights)","Milan (5 Days, 4 Nights)","Naples (5 Days, 4 Nights)","Rome (5 Days, 4 Nights)","Venice (5 Days, 4 Nights)"],
    "Japan": ["Kyoto (6 Days, 5 Nights)"],
    "Malaysia": ["Kuala Lumpur (6 Days, 5 Nights)"],
    "Maldives": ["Maldives (6 Days, 5 Nights)"],
    "Mexico": ["Cancun (6 Days, 5 Nights)","Cabo San Lucas (5 Days, 4 Nights)","Puerto Vallarta (6 Days, 5 Nights)"],
    "Netherlands": ["Amsterdam (4 Days, 3 Nights)"],
    "New Zealand": ["Auckland (5 Days, 4 Nights)","Bay Of Plenty & Rotorua (5 Days, 4 Nights)","Christchurch (5 Days, 4 Nights)","Dunedin (5 Days, 4 Nights)","Marlborough (5 Days, 4 Nights)","Wellington (5 Days, 4 Nights)"],
    "Philippines": ["Bohol (6 Days, 5 Nights)","Boracay (5 Days, 4 Nights)"],
    "Portugal": ["Lisbon (5 Days, 4 Nights)"],
    "Puerto Rico": ["San Juan (5 Days, 4 Nights)"],
    "Saudi Arabia": ["Mecca (4 Days, 3 Nights)"],
    "Singapore": ["Singapore (5 Days, 4 Nights)"],
    "South Africa": ["Cape Town (5 Days, 4 Nights)"],
    "South Korea": ["Seoul (6 Days, 5 Nights)"],
    "Spain": ["Barcelona (5 Days, 4 Nights)","Benidorm (5 Days, 4 Nights)","Majorca (5 Days, 4 Nights)","Madrid (5 Days, 4 Nights)","Tenerife (5 Days, 4 Nights)"],
    "Sweden": ["Stockholm (5 Days, 4 Nights)"],
    "Tanzania": ["Zanzibar (5 Days, 4 Nights)"],
    "Thailand": ["Bangkok (5 Days, 4 Nights)","Koh Samui (8 Days, 7 Nights)","Pattaya (6 Days, 5 Nights)","Phuket (8 Days, 7 Nights)"],
    "Turkey": ["Antalya (4 Days, 3 Nights)","Bodrum (5 Days, 4 Nights)","Istanbul (5 Days, 4 Nights)"],
    "UAE": ["Dubai (5 Days, 4 Nights)"],
    "United Kingdom": ["Edinburgh (4 Days, 3 Nights)","Glasgow (4 Days, 3 Nights)","London (4 Days, 3 Nights)"],
    "United States": [
      "Atlanta (4 Days, 3 Nights)",
      "Boston (4 Days, 3 Nights)",
      "Branson (4 Days, 3 Nights)",
      "Cape Cod (4 Days, 3 Nights)",
      "Chicago (4 Days, 3 Nights)",
      "Daytona Beach (4 Days, 3 Nights)",
      "Denver, Colorado (4 Days, 3 Nights)",
      "Fort Lauderdale (4 Days, 3 Nights)",
      "Galveston (4 Days, 3 Nights)",
      "Gatlinburg (4 Days, 3 Nights)",
      "Grand Canyon (4 Days, 3 Nights)",
      "Hawaii (6 Days, 5 Nights)",
      "Las Vegas (4 Days, 3 Nights)",
      "Los Angeles (4 Days, 3 Nights)",
      "Miami (4 Days, 3 Nights)",
      "Nashville (4 Days, 3 Nights)",
      "New Orleans (4 Days, 3 Nights)",
      "New York City (4 Days, 3 Nights)",
      "North Carolina (8 Days, 7 Nights)",
      "Ocean City (4 Days, 3 Nights)",
      "Orlando (4 Days, 3 Nights)",
      "Palm Springs (4 Days, 3 Nights)",
      "Panama City (4 Days, 3 Nights)",
      "Phoenix (4 Days, 3 Nights)",
      "San Antonio (4 Days, 3 Nights)",
      "San Diego (4 Days, 3 Nights)",
      "San Francisco (4 Days, 3 Nights)",
      "San Juan (5 Days, 4 Nights)",
      "Savannah (4 Days, 3 Nights)",
      "Sedona (4 Days, 3 Nights)",
      "St. Petersburg (4 Days, 3 Nights)",
      "Virginia Beach (4 Days, 3 Nights)",
      "Washington DC (8 Days, 7 Nights)",
      "Winnipeg (4 Days, 3 Nights)" // if you want to remove duplicates adjust accordingly
    ],
    "Vanuatu": ["Vanuatu (5 Days, 4 Nights)"]
  };
  // -----------------------------------------------------------------------------------------------

  // Populate countries initially in alphabetical order
  function populateCountryList(filterFn) {
    const keys = Object.keys(destinations).sort((a,b)=>a.localeCompare(b));
    countrySelect.innerHTML = "<option value=''>Select Country / Region</option>";
    keys.forEach(country=>{
      if(!filterFn || filterFn(country)) {
        const o = document.createElement("option");
        o.value = country;
        o.textContent = country;
        countrySelect.appendChild(o);
      }
    });
  }

  function populateCityList(country) {
    citySelect.innerHTML = "<option value=''>Select Destination</option>";
    if(!country) return;
    const cities = (destinations[country] || []).slice().sort((a,b)=>a.localeCompare(b));
    cities.forEach(c=>{
      const o = document.createElement("option");
      o.value = c;
      o.textContent = c;
      citySelect.appendChild(o);
    });
  }

  // initialize
  populateCountryList();

  // keep client price updated
  function updateDisplayedPrice() {
    const country = countrySelect.value;
    // city is optional for client display but we want it selected
    const promo = promoInput.value.trim();
    const price = computeClientPrice(country, citySelect.value, promo);
    priceDisplay.textContent = `Voucher Price: $${price}`;
  }

  // search logic (smart search matches countries or cities)
  searchBox.addEventListener("input", (e)=>{
    const q = e.target.value.trim().toLowerCase();
    if(!q) { populateCountryList(); return; }
    populateCountryList((country)=>{
      if(country.toLowerCase().includes(q)) return true;
      return destinations[country].some(city=>city.toLowerCase().includes(q));
    });
    // if first country after filter has only one matched city, auto-select it
  });

  countrySelect.addEventListener("change", ()=>{
    populateCityList(countrySelect.value);
    updateDisplayedPrice();
  });

  citySelect.addEventListener("change", updateDisplayedPrice);
  promoInput.addEventListener("input", updateDisplayedPrice);

  // payment click -> request backend create-checkout-session
  payBtn.addEventListener("click", async ()=>{
    payBtn.disabled = true;
    const country = countrySelect.value;
    const city = citySelect.value;
    const promo = promoInput.value.trim();

    if(!country) { alert("Please choose a country/region."); payBtn.disabled = false; return; }
    if(!city) { alert("Please choose a destination."); payBtn.disabled = false; return; }

    try {
      const response = await fetch(`${backendURL}/api/create-checkout-session`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    price,
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
  }),
});
      const json = await res.json();
      if (json.error) {
        alert("Payment setup error: " + json.error);
        console.error("backend error", json);
        payBtn.disabled = false;
        return;
      }
      // redirect to Stripe Checkout
      const { sessionId } = json;
      const ret = await stripe.redirectToCheckout({ sessionId });
      if (ret && ret.error) {
        alert(ret.error.message);
        console.error(ret);
        payBtn.disabled = false;
      }
    } catch (err) {
      console.error(err);
      alert("Network error contacting backend. Check console.");
      payBtn.disabled = false;
    }
  });

  // show price initially
  updateDisplayedPrice();
  </script>
</body>
</html>
